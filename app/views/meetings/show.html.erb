<h1><%= @meeting.body_name %></h1>

<p>
  <strong>Date:</strong>
  <%= @meeting.starts_at&.strftime("%B %d, %Y %l:%M %p") %>
</p>

<p>
  <strong>Status:</strong>
  <%= @meeting.status.titleize %>
</p>

<p>
  <strong>Original Source:</strong>
  <%= link_to "View on City Website", @meeting.detail_page_url, target: "_blank" %>
</p>

<% if @meeting.meeting_summaries.any? %>
  <div style="background-color: #f0f7ff; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
    <h2>
      <% if @meeting.meeting_summaries.exists?(summary_type: "minutes_recap") %>
        Meeting Recap
      <% else %>
        Packet Analysis
      <% end %>
    </h2>
    <div class="prose">
      <%= simple_format @meeting.meeting_summaries.last.content %>
    </div>
    <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
      <em>Generated by AI based on official documents. Verify with original sources.</em>
    </div>
  </div>
<% end %>

<% if @meeting.agenda_items.any? %>
  <h2>Agenda</h2>
  <div class="agenda-list">
    <% @meeting.agenda_items.order(:order_index).each do |item| %>
      <div class="agenda-item" style="margin-bottom: 20px; border-left: 4px solid #eee; padding-left: 15px;">
        <div style="font-weight: bold; font-size: 1.1em;">
          <% if item.number.present? %>
            <span style="color: #666; margin-right: 5px;"><%= item.number %></span>
          <% end %>
          <%= item.title %>
        </div>
        
        <% if item.summary.present? %>
          <div style="margin-top: 5px; color: #444;">
            <strong>Summary:</strong> <%= item.summary %>
          </div>
        <% end %>
        
        <% if item.recommended_action.present? %>
          <div style="margin-top: 5px; font-style: italic; color: #2c5282;">
            <strong>Action:</strong> <%= item.recommended_action %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>

<h2>Documents</h2>

<% if @meeting.meeting_documents.any? %>
  <ul>
    <% @meeting.meeting_documents.each do |doc| %>
      <li>
        <strong><%= doc.document_type.humanize %></strong>
        <% if doc.file.attached? && doc.document_type.include?("pdf") %>
          (<%= number_to_human_size(doc.file.byte_size) %>)
          <% if doc.text_quality.present? %>
            - Quality: <%= doc.text_quality.humanize %>
          <% end %>
          <br>
          <%= link_to "Download PDF", rails_blob_path(doc.file, disposition: "attachment") %>
        <% else %>
          <br>
          <%= link_to "View Original", doc.source_url, target: "_blank" %>
        <% end %>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>No documents found for this meeting.</p>
<% end %>

<br>
<%= link_to "Back to Meetings", meetings_path %>
