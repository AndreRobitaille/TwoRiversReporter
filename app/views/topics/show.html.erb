<% content_for(:title) { "#{@topic.name} - Topics - Two Rivers Reporter" } %>

<%# === 1. Header === %>
<div class="page-header">
  <h1 class="page-title"><%= @topic.name %></h1>
  <% if @topic.description.present? %>
    <p class="page-subtitle"><%= @topic.description %></p>
  <% end %>
</div>

<%# === 2. Coming Up === %>
<% if @upcoming.any? %>
  <section class="topic-upcoming section">
    <h2 class="section-title">Coming Up</h2>
    <div class="card-grid">
      <% @upcoming.each do |appearance| %>
        <%= link_to meeting_path(appearance.meeting), class: "card card-link card-link--upcoming" do %>
          <div class="card-body">
            <div class="text-sm text-secondary mb-1">
              <%= appearance.meeting.body_name %>
            </div>
            <div class="font-bold mb-1">
              <%= appearance.meeting.starts_at.strftime("%A, %B %-d at %-I:%M %p") %>
            </div>
            <% if appearance.meeting.location.present? %>
              <div class="text-sm text-secondary mb-2">
                <%= appearance.meeting.location %>
              </div>
            <% end %>
            <% if appearance.agenda_item %>
              <div class="mb-2">
                <%= appearance.agenda_item.title %>
              </div>
              <% if public_comment_meeting?(appearance.agenda_item) %>
                <span class="badge badge--info mb-2">Public comment period</span>
              <% end %>
            <% end %>
            <div class="mt-3">
              <span class="btn btn--secondary btn--sm">View meeting →</span>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    <p class="text-sm text-secondary mt-3">
      You can always contact your council members about this topic.
    </p>
  </section>
<% end %>

<%# === 3. Briefing Headline === %>
<% if @briefing&.headline.present? %>
  <section class="topic-briefing-headline section">
    <div class="card card--warm">
      <div class="card-body">
        <p class="briefing-headline-text"><%= @briefing.headline %></p>
        <%= briefing_freshness_badge(@briefing) %>
      </div>
    </div>
  </section>
<% end %>

<%# === 4. What's Going On (Editorial) === %>
<% if @briefing&.editorial_content.present? %>
  <section class="topic-briefing-editorial section topic-section">
    <h2 class="section-title">What's Going On</h2>
    <div class="card">
      <div class="card-body briefing-editorial-content">
        <%= sanitize(render_briefing_editorial(@briefing.editorial_content)) %>
      </div>
    </div>
  </section>
<% end %>

<%# === 5. Record (Factual) === %>
<% if @briefing&.record_content.present? %>
  <section class="topic-briefing-record section topic-section">
    <h2 class="section-title">Record</h2>
    <div class="card card--surface-raised">
      <div class="card-body">
        <%= sanitize(render_briefing_record(@briefing.record_content)) %>
      </div>
    </div>
  </section>
<% end %>

<%# === 6. Key Decisions === %>
<% if @decisions.any? %>
  <section class="topic-decisions section topic-section">
    <h2 class="section-title">Key Decisions</h2>
    <% @decisions.each do |motion| %>
      <div class="topic-decision-item">
        <div class="flex justify-between items-center mb-1">
          <span class="font-bold"><%= motion.meeting.body_name %></span>
          <span class="text-sm text-secondary">
            <%= motion.meeting.starts_at.strftime("%B %-d, %Y") %>
          </span>
        </div>
        <div class="mb-2"><%= motion.description %></div>
        <div class="mb-2">
          <span class="badge <%= case motion.outcome&.downcase
            when 'passed', 'adopted', 'approved' then 'badge--success'
            when 'failed', 'defeated' then 'badge--danger'
            else 'badge--default'
          end %>">
            <%= motion_outcome_text(motion) %>
          </span>
        </div>
        <% if motion.votes.any? %>
          <div class="votes-label text-sm font-medium text-secondary">How they voted</div>
          <div class="votes-grid">
            <% motion.votes.each do |vote| %>
              <div class="vote-card vote-card--<%= vote.value %> text-sm">
                <span class="font-bold"><%= vote.member.name %></span>
                <span class="vote-value--<%= vote.value %>"><%= vote.value.titleize %></span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </section>
<% end %>

<%# === Empty state === %>
<% if @upcoming.empty? && @briefing.nil? && @decisions.empty? %>
  <div class="topic-empty-state empty-state">
    <p class="mb-0">No meeting activity recorded for this topic yet.</p>
  </div>
<% end %>

<%# === Footer === %>
<div class="mt-8">
  <%= link_to "← Back to Topics", topics_path, class: "btn btn--secondary" %>
</div>
